{
  "code": "import { ui } from \"../../ui/layaMaxUI\";\r\nimport LoadHelper from \"./LoadHelper\";\r\nimport ResConfig from \"../../utils/ResConfig\";\r\nvar Event = Laya.Event;\r\nvar Handler = Laya.Handler;\r\nvar Browser = Laya.Browser;\r\nvar Tween = Laya.Tween;\r\nvar LoadUI = ui.smile.LoadUI;\r\nexport default class LoadingView extends LoadUI {\r\n    constructor() {\r\n        super();\r\n        this.autoDestroyAtClosed = true;\r\n    }\r\n    onAwake() {\r\n        this.bar.value = 0;\r\n        this.bar.changeHandler = new Handler(this, this.changeValue, null, false);\r\n        this.logoMovie.play(0, true);\r\n        Laya.loader.on(Event.ERROR, this, (e) => {\r\n            console.log(\"Laya.loader:ERROR\" + JSON.stringify(e));\r\n        });\r\n        let assets = ResConfig.options.resConfig;\r\n        let jsonsOptions = assets.jsonsOptions, resources = [], info = assets.baseInfo;\r\n        for (let key in jsonsOptions) {\r\n            let option = jsonsOptions[key];\r\n            resources.push(option);\r\n            let res = Laya.loader.getRes(option);\r\n            if (res)\r\n                Laya.loader.clearRes(option);\r\n        }\r\n        resources.push(\"img_empty.png\");\r\n        resources = resources.concat(LoadHelper.i.parseSources(assets));\r\n        this.versionText.text = ResConfig.options.appConfig.gameOptions.version;\r\n        if (!Browser.onMiniGame) {\r\n            let subpackages = LoadHelper.i.parseSources(ResConfig.options.appConfig.subpackages);\r\n            resources = resources.concat(subpackages);\r\n        }\r\n        console.log(\"smile----resources:\" + JSON.stringify(resources));\r\n        Laya.loader.load(resources, Handler.create(this, (sucess) => {\r\n            console.log(\"smile------resources:\" + JSON.stringify(sucess));\r\n            if (sucess) {\r\n                if (Browser.onMiniGame) {\r\n                    window.platform.i.menuShareMessage();\r\n                    console.log(\"smile------开放域:\" + JSON.stringify(\"发送数据\"));\r\n                    Laya.MiniAdpter.sendAtlasToOpenDataContext(\"res/atlas/rank.atlas\");\r\n                    Laya.MiniAdpter.sendSinglePicToOpenDataContext(\"rank/fontclip_rank.png\");\r\n                    this.loadSubpackages();\r\n                }\r\n            }\r\n        }), this.bar.changeHandler);\r\n    }\r\n    onEnable() {\r\n        this.alpha = 0;\r\n        this.zOrder = 1200;\r\n        Tween.to(this, { alpha: 1 }, 50);\r\n    }\r\n    changeValue(progress) {\r\n        if (this.bar && this.bar.value >= 1) {\r\n            if (!Browser.onMiniGame) {\r\n                this.bar.value = 1;\r\n                this.bar.changeHandler.clear();\r\n                this.event(LoadingView.LOAD_COMPLETE);\r\n            }\r\n            else {\r\n                this.bar.value = 0;\r\n            }\r\n            return;\r\n        }\r\n        if (this.bar) {\r\n            this.bar.value = progress;\r\n        }\r\n    }\r\n    loadSubpackages() {\r\n        let packages = ResConfig.options.appConfig.subpackages, count = 0;\r\n        if (!packages.length) {\r\n            console.log(\"smile------:\" + JSON.stringify(\"分包已经加载成功\"));\r\n            this.bar.changeHandler.clear();\r\n            this.event(LoadingView.LOAD_COMPLETE);\r\n            return;\r\n        }\r\n        let url = packages.shift()[\"name\"], self = this;\r\n        let loadTask = window.platform.i.loadSubpackage({\r\n            name: url,\r\n            success: function (res) {\r\n                self.loadSubpackages();\r\n            },\r\n            fail: function (res) {\r\n            },\r\n            complete: function (res) {\r\n            }\r\n        });\r\n        console.log(\"smile------loadTask.onProgressUpdate:\" + loadTask.onProgressUpdate);\r\n        loadTask.onProgressUpdate((res) => {\r\n            this.bar.value = res.progress / 100;\r\n            console.log('下载进度', res.progress);\r\n        });\r\n    }\r\n}\r\nLoadingView.LOAD_COMPLETE = \"load_complete\";\r\n//# sourceMappingURL=LoadingView.js.map",
  "references": [
    "/jsroads/blog/layademo-puremvc/src/ui/layaMaxUI.ts",
    "/jsroads/blog/layademo-puremvc/src/view/loading/LoadHelper.ts",
    "/jsroads/blog/layademo-puremvc/src/utils/ResConfig.ts",
    "/jsroads/blog/layademo-puremvc/src/utils/AppScreen.ts"
  ],
  "map": "{\"version\":3,\"file\":\"LoadingView.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/view/loading/LoadingView.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
